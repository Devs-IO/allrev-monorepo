<div class="container-fluid py-4">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col">
      <h1 class="display-6 fw-bold">
        <i class="bi bi-briefcase me-2"></i>Minhas Ordens
      </h1>
      <p class="text-muted">Visualize e acompanhe seus trabalhos</p>
    </div>
  </div>

  <!-- Mensagem de Erro -->
  <div
    *ngIf="errorMessage"
    class="alert alert-danger alert-dismissible fade show"
    role="alert"
  >
    <i class="bi bi-exclamation-triangle me-2"></i>
    {{ errorMessage }}
    <button
      type="button"
      class="btn-close"
      (click)="errorMessage = ''"
      aria-label="Close"
    ></button>
  </div>

  <!-- Carregando -->
  <div *ngIf="loading" class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Carregando...</span>
  </div>

  <!-- Sem Ordens -->
  <div *ngIf="!loading && orders.length === 0" class="alert alert-info">
    <i class="bi bi-info-circle me-2"></i>
    Você ainda não possui ordens registradas.
  </div>

  <!-- Tabela de Ordens (Desktop) -->
  <div *ngIf="!loading && orders.length > 0" class="d-none d-lg-block">
    <div class="table-responsive">
      <table class="table table-hover table-bordered">
        <thead class="table-light">
          <tr>
            <th>Nº Ordem</th>
            <th>Data</th>
            <th>Descrição</th>
            <th>Valor Total</th>
            <th>Pago</th>
            <th>Pendente</th>
            <th>Status Pagto</th>
            <th>Status Trabalho</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let order of orders">
            <td class="fw-semibold">{{ order.orderNumber || "—" }}</td>
            <td>{{ formatDate(order.contractDate) }}</td>
            <td class="text-truncate" title="{{ order.description }}">
              {{ order.description || "—" }}
            </td>
            <td class="text-end fw-semibold">
              {{ formatCurrency(order.amountTotal) }}
            </td>
            <td class="text-end">{{ formatCurrency(order.amountPaid) }}</td>
            <td class="text-end fw-semibold text-warning">
              {{ formatCurrency(getRemainingAmount(order)) }}
            </td>
            <td>
              <span [ngClass]="getPaymentStatusClass(order.paymentStatus)">
                {{ getPaymentStatusLabel(order.paymentStatus) }}
              </span>
            </td>
            <td>
              <span [ngClass]="getWorkStatusClass(order.workStatus)">
                {{ getWorkStatusLabel(order.workStatus) }}
              </span>
            </td>
            <td>
              <button
                class="btn btn-sm btn-outline-primary"
                (click)="viewOrderDetails(order.id)"
              >
                <i class="bi bi-eye me-1"></i>Ver Detalhes
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Cards de Ordens (Mobile) -->
  <div *ngIf="!loading && orders.length > 0" class="d-lg-none">
    <div class="row g-3">
      <div class="col-12" *ngFor="let order of orders">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <div class="row mb-3">
              <div class="col">
                <h5 class="card-title mb-0">{{ order.orderNumber || "—" }}</h5>
                <small class="text-muted">{{
                  formatDate(order.contractDate)
                }}</small>
              </div>
              <div class="col-auto text-end">
                <span [ngClass]="getPaymentStatusClass(order.paymentStatus)">
                  {{ getPaymentStatusLabel(order.paymentStatus) }}
                </span>
              </div>
            </div>

            <p class="card-text text-muted small mb-3">
              {{ order.description || "Sem descrição" }}
            </p>

            <div class="row text-center mb-3">
              <div class="col-6">
                <small class="d-block text-muted">Valor Total</small>
                <strong>{{ formatCurrency(order.amountTotal) }}</strong>
              </div>
              <div class="col-6">
                <small class="d-block text-muted">Pendente</small>
                <strong class="text-warning">{{
                  formatCurrency(getRemainingAmount(order))
                }}</strong>
              </div>
            </div>

            <div class="mb-3">
              <span
                [ngClass]="getWorkStatusClass(order.workStatus)"
                class="me-2"
              >
                {{ getWorkStatusLabel(order.workStatus) }}
              </span>
              <small class="text-muted">
                {{ getTotalInstallments(order) }} parcelas
              </small>
            </div>

            <button
              class="btn btn-sm btn-outline-primary w-100"
              (click)="viewOrderDetails(order.id)"
            >
              <i class="bi bi-eye me-1"></i>Ver Detalhes
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Paginação -->
  <div
    *ngIf="!loading && orders.length > 0"
    class="d-flex justify-content-between align-items-center mt-4"
  >
    <div class="text-muted small">
      Mostrando <strong>{{ currentPage * pageSize + 1 }}</strong> a
      <strong>{{ Math.min((currentPage + 1) * pageSize, totalOrders) }}</strong>
      de <strong>{{ totalOrders }}</strong> ordens
    </div>

    <div class="btn-group" role="group">
      <button
        type="button"
        class="btn btn-outline-secondary"
        (click)="previousPage()"
        [disabled]="currentPage === 0"
      >
        <i class="bi bi-chevron-left"></i> Anterior
      </button>
      <button
        type="button"
        class="btn btn-outline-secondary"
        (click)="nextPage()"
        [disabled]="(currentPage + 1) * pageSize >= totalOrders"
      >
        Próximo <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </div>
</div>
